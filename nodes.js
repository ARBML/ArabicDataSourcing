const url = "https://sheets.googleapis.com/v4/spreadsheets/1YO-Vl4DO-lnp8sQpFlcX1cDtzxFoVkCmU1PVw_ZHJDg?key=AIzaSyC6dSsmyQw-No2CJz7zuCrMGglNa3WwKHU&includeGridData=true";
function reformat_numbers(num) {
    if (num === undefined)
        return ''
    values = num.split(',')
    if (values.length < 2) {
        return num
    } else if (values.length == 2) {
        return values[0] + 'K'
    } else
        return values[0] + 'M'
}

function reformat_dialect(dialect)
{
    
    if (dialect.trim() != 'other')
    {
        dialect = dialect.split(':')[0]
        dialect = dialect.split('-')[1]
    }
    
    return dialect
}

function reformat_tasks(tasks)
{
    let out_html = ''

    tasks = tasks.split(',')
    for(let j = 0 ; j < tasks.length ; j += 1){
        out_html += tasks[j]+'</br>'
    }

    return out_html
}

function createHtml(i)
{
    let div = '<div style="font-family: Cairo, "Open Sans"> '
    let table = '<table style="border-collapse: collapse; border: none;">'
    let html_out = div + table 
    let list_to_show = ['Name', 'Year','Dialect', 'Volume', 'Tasks']
    for(let j = 0 ; j < list_to_show.length ; j += 1){

        let index_to_header = headersWhiteList.indexOf(list_to_show[j])
        let header = headersWhiteList[index_to_header]
        let value = ' ' +dataset[i][index_to_header]
        html_out += '<tr style="border: none;">'
        html_out += '<td style="border: none;">'
        html_out += '<b>'+header+'</b>'
        html_out += '</td>'
        html_out += '<td style="border: none;">'
        
        if(header == 'Volume')
        {
            html_out += reformat_numbers(value)+ ' '+ dataset[i][index_to_header+1]
        }
        else if (header == 'Name')
        {
            html_out += `<a href = "">${value}</a>`
        }
        else if (header == 'Dialect')
        {
            html_out += reformat_dialect(value)
        }
        else if (header == 'Tasks'){
            html_out += reformat_tasks(value)
        }
        else
        {
            html_out += value
        }
        
        html_out += '</td>'
        html_out += '</tr>'
    }

    return html_out+'</table>'+'</div>'
}
axios.get(url, ).then(function(response) {
    let rowData = response.data.sheets[0].data[0].rowData
    let headers = []
    headersWhiteList = ['Name', 'Link', 'License', 'Year', 'Language', 'Dialect', 'Domain', 'Form', 'Volume', 'Unit', 'Ethical Risks', 'Script', 'Access', 'Tasks', 'Venue Type']
    $('.loading-spinner').hide()
    
    // Grabbing header's index's to help us to get value's of just by header index 
    rowData[1].values.filter(header => header.formattedValue != undefined).forEach((header, headerIndex) => {
        if (headersWhiteList.includes(header.formattedValue)){
            headers.push({
                index: headerIndex,
                title: header.formattedValue
            })
        }
    })

    // console.log(headers)
    let tempRows = []
    rowData.filter(row => {
        tempRows.push(row.values)
    })
    
    // Grabbing row's values
    let rows = []
    for (let index = 2; index < tempRows.length; index++) {
        const fileds = tempRows[index]
        if (fileds != undefined) {
            // if (!isNaN(fileds[0].formattedValue)){
                rows.push(fileds)
            // }
        }
        
    }
    
        //  Createing table data
        dataset = []
        for (let index = 0; index < rows.length; index++) {
            const row = rows[index];
            let entry = {}
            if (isNaN(row[0].formattedValue))
            {
                continue
            }
            for (let index = 0; index < headersWhiteList.length; index++) {
                entry[index] = row[headers[index].index].formattedValue
            }
            dataset.push(entry)
        }
        console.log(dataset[0])
            var embeddings = {"columns":[0,1],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522],"data":[[29.5251617432,18.7654075623],[39.3104820251,11.2921504974],[33.7022361755,16.7496700287],[41.037437439,13.2844114304],[37.8686981201,11.129026413],[37.5861663818,25.444694519],[37.4252929688,21.7444725037],[39.4421768188,11.5505495071],[48.5677642822,17.1015663147],[32.5016403198,23.530796051],[25.8782272339,29.2169837952],[29.3812904358,19.983165741],[39.2755126953,11.8270759583],[48.4578094482,22.7019138336],[26.0387687683,17.17045784],[37.9810714722,13.7594261169],[24.2129535675,15.6269369125],[44.0558166504,16.1536216736],[39.6326751709,12.828417778],[24.4182910919,32.1826553345],[33.1774749756,38.6274642944],[50.4994926453,16.2114143372],[36.5777359009,24.579624176],[47.3506851196,19.081741333],[35.5305862427,16.7929134369],[36.5410881042,24.6753730774],[40.5435638428,22.606967926],[28.938615799,39.3550643921],[31.3738365173,25.8121509552],[26.064163208,14.56346035],[26.0643424988,14.5635156631],[26.5586357117,15.2080526352],[27.9183750153,16.9279975891],[25.190618515,16.447101593],[26.6303653717,15.2373332977],[36.8947868347,15.2208414078],[39.0207710266,14.7599496841],[25.5366096497,27.2298622131],[27.887046814,34.0414428711],[29.5874137878,18.1948623657],[26.6220035553,27.8857135773],[29.4165458679,13.3414745331],[34.6665344238,25.0841331482],[39.6431045532,26.3207588196],[29.5917816162,17.5130081177],[34.5668563843,25.7822399139],[30.1764373779,30.8500785828],[24.0919723511,31.7633476257],[21.5652732849,32.3694458008],[32.2090339661,18.2460613251],[32.1717376709,18.2885627747],[44.3185882568,21.5522022247],[45.4418487549,24.7622070312],[29.6940040588,25.8481826782],[35.9350585938,23.5567188263],[33.4217605591,17.4491043091],[26.8919582367,29.066198349],[20.7393665314,10.1387815475],[50.512966156,23.0598182678],[39.3546676636,28.6780776978],[49.4120521545,20.9306793213],[37.4719810486,33.8675994873],[45.8621940613,20.4813632965],[37.9170684814,33.5582466125],[26.1150417328,30.7106132507],[37.5761795044,34.294757843],[29.8275413513,24.7259483337],[37.3024749756,15.3720054626],[30.1740722656,23.9076709747],[32.9749755859,27.5400276184],[43.5668487549,22.5496387482],[39.4009437561,28.6810741425],[40.4745330811,16.0424690247],[43.3051605225,28.5360488892],[37.5365982056,34.4513397217],[31.2856216431,25.9274253845],[40.7637710571,12.2042264938],[48.7270736694,17.761932373],[50.4071426392,20.7992973328],[50.1392173767,21.6734161377],[51.9496612549,22.3628330231],[51.9114532471,21.3395729065],[39.6725234985,12.930724144],[40.6610183716,14.4011583328],[40.6810073853,13.9388208389],[33.3573112488,17.4072723389],[26.1942386627,27.4892578125],[31.1938934326,11.0424633026],[40.5353889465,14.8885421753],[38.1564292908,12.6234264374],[23.0653762817,17.516368866],[33.6432266235,38.3083648682],[33.8148345947,37.1414260864],[39.586807251,11.9872102737],[34.5609512329,27.2491493225],[37.4109840393,21.773065567],[36.5284004211,21.9916439056],[39.8097000122,14.9361600876],[48.6930427551,14.5974617004],[32.1569213867,29.0384407043],[35.5649795532,29.3825187683],[39.1403808594,13.9348583221],[39.2039451599,13.9438390732],[34.9207382202,26.8564529419],[19.2826938629,8.1166553497],[36.2827758789,20.8200702667],[48.7067337036,21.6257095337],[37.0670700073,13.5803928375],[50.115447998,21.6404857635],[26.7657718658,26.7421607971],[24.812379837,14.8375864029],[31.452796936,39.7721366882],[37.7574539185,20.2933616638],[34.9907913208,23.0461406708],[31.1740474701,39.1233520508],[35.998626709,22.6571140289],[29.5972919464,42.5778465271],[23.4076194763,35.3598327637],[23.4349308014,35.0595932007],[16.663772583,28.1239356995],[29.0857257843,37.7391471863],[31.4668426514,22.1477355957],[31.3916320801,34.340297699],[38.1820526123,33.1244125366],[26.26902771,18.5870933533],[26.3001003265,37.4619750977],[33.9723320007,27.7097873688],[44.0576095581,20.7998085022],[41.4866867065,14.1300592422],[40.9019241333,15.1361951828],[37.9834442139,21.5110549927],[35.5309906006,16.7933311462],[21.4063682556,34.619682312],[42.6706352234,13.1791687012],[42.6698684692,13.1790571213],[48.6839981079,17.4584121704],[43.2944793701,28.5370826721],[38.3216362,35.294719696],[45.3094749451,14.4622020721],[22.0384922028,29.5765724182],[39.2865180969,15.6221818924],[40.3509140015,17.3066158295],[44.1018791199,21.842168808],[10.8049640656,35.1968765259],[26.4914321899,28.2880821228],[26.0904064178,31.7142791748],[33.5253219604,42.2566757202],[33.5999526978,41.3711090088],[33.3500213623,41.4217910767],[32.006313324,22.321313858],[31.0142154694,41.2601318359],[29.5334339142,32.0210418701],[31.0645389557,15.7289905548],[30.4731693268,15.993519783],[50.5124397278,18.2616100311],[30.1678123474,23.9699325562],[45.9214019775,20.5703639984],[35.8427581787,22.9107398987],[20.2945480347,32.4345474243],[35.2459106445,28.7818450928],[24.4112644196,26.020565033],[35.5131149292,24.4245185852],[41.8596496582,16.1979141235],[49.6328353882,15.0215902328],[24.9393787384,28.6801700592],[30.5477638245,16.0040493011],[33.0170516968,25.0809173584],[39.1128082275,14.982626915],[27.8992347717,23.9009342194],[26.8285045624,17.9237251282],[28.2207736969,18.9452648163],[33.8155822754,28.1501216888],[48.8949661255,14.7588863373],[27.462808609,23.2878360748],[27.5415744781,36.3688430786],[20.4563732147,5.2109088898],[20.4572544098,5.2094478607],[52.0414886475,22.3530483246],[47.5326805115,24.4929885864],[22.9626979828,17.4757652283],[45.0725021362,14.9248247147],[3.9484081268,44.0803642273],[30.7657814026,41.480506897],[34.4442329407,38.4271850586],[48.4567489624,18.4275569916],[19.1659507751,33.7772293091],[41.7310142517,16.4126472473],[35.7467651367,26.15716362],[9.4647722244,5.9341087341],[37.6630744934,31.7801876068],[38.2400588989,12.4282436371],[47.5240020752,18.7084445953],[38.8953704834,33.1844558716],[27.9578819275,41.7570495605],[43.2719802856,10.3184127808],[42.9678192139,10.3980674744],[29.5243148804,32.0816841125],[39.8565254211,26.2587432861],[43.3960380554,16.7892932892],[32.2223129272,38.0060997009],[43.6408004761,20.3788127899],[27.5417823792,5.7409286499],[33.011177063,25.0945510864],[30.1531333923,30.8642139435],[17.0551185608,23.4066047668],[6.3692760468,42.9536895752],[12.2555522919,3.1740188599],[25.2558574677,45.1684265137],[44.1804428101,16.1299629211],[46.4157142639,17.1383018494],[27.6351413727,28.3445396423],[47.2474250793,18.5458602905],[38.9516906738,9.8072795868],[29.8935146332,41.9133071899],[44.9162406921,16.5481452942],[49.282623291,21.3343772888],[48.0253829956,17.8982543945],[46.8578987122,23.6225776672],[51.1275863647,21.9399909973],[31.1393737793,11.1915121078],[48.5499687195,14.3921232224],[45.0979232788,20.6106529236],[41.9458198547,14.8257703781],[47.6819992065,17.6834449768],[31.1361980438,11.2065429688],[46.2219085693,23.8686790466],[44.9343643188,15.0850791931],[49.25756073,21.3547611237],[32.0902252197,39.4948654175],[32.0566978455,40.7031097412],[26.3873767853,32.0196914673],[25.1987342834,30.7715854645],[22.8321380615,35.2353782654],[31.6430015564,39.3300628662],[22.3727550507,29.9418811798],[13.0265579224,20.4298152924],[34.9541893005,27.5973777771],[12.8465394974,36.9211883545],[5.6631355286,42.8844032288],[36.5484046936,35.152797699],[36.8766975403,20.2935409546],[27.7093086243,37.6303138733],[36.8242034912,20.3566246033],[27.5722846985,36.224811554],[33.3706092834,41.3671722412],[26.7122364044,37.439540863],[7.0655937195,43.2769813538],[50.489074707,23.4061336517],[6.0095119476,43.4474868774],[8.7467479706,16.5561275482],[27.945066452,39.105632782],[28.8652420044,36.3950424194],[33.4805717468,23.5677986145],[33.0001983643,38.3018112183],[30.8561096191,37.7491531372],[23.1285400391,35.518989563],[21.2437820435,32.5731811523],[35.679473877,39.8468208313],[12.0084953308,6.5150241852],[13.1671152115,34.9191703796],[32.5099983215,37.5711669922],[23.3372497559,33.3045043945],[7.0123882294,42.8787231445],[22.877122879,35.4013519287],[23.2846317291,34.9162979126],[5.7221183777,43.2418060303],[9.1595420837,38.7285079956],[14.7742128372,42.8500061035],[51.3575439453,19.8948402405],[40.6050796509,22.6896286011],[12.3636322021,28.6249065399],[29.2468357086,25.7591705322],[6.2407836914,42.4470977783],[5.7301044464,44.4732093811],[23.7789478302,28.0236244202],[18.0842056274,19.7144012451],[12.5109901428,21.0172958374],[8.7467479706,16.5561275482],[9.6268405914,17.3752098083],[9.9676790237,7.5927391052],[12.7953996658,4.545747757],[13.03424263,2.7408809662],[6.8114585876,42.5117034912],[13.1117191315,19.6246070862],[12.3179559708,20.1842651367],[18.0384788513,19.7592449188],[29.8707542419,16.4561061859],[11.6943674088,35.974609375],[13.8927402496,34.7812728882],[9.2968406677,30.9050350189],[40.1797180176,26.3229026794],[9.6644849777,17.4677009583],[8.9309511185,20.9454059601],[25.2933292389,47.0062255859],[14.2048015594,5.6836261749],[14.2557878494,4.6762523651],[12.4537391663,21.0023727417],[13.0274839401,7.9442844391],[8.8182315826,20.0977153778],[10.9886722565,7.8654212952],[31.607093811,8.5265340805],[34.5273475647,6.8255348206],[10.2429943085,5.379983902],[12.5950365067,5.2553977966],[12.2068090439,34.0128364563],[10.1629390717,35.9268455505],[12.2594938278,35.756149292],[22.9713058472,34.8564338684],[41.0020828247,11.1429481506],[29.8018226624,18.6920490265],[9.3711643219,31.0054893494],[18.7191028595,21.7490234375],[18.9988479614,48.7909240723],[34.7608261108,6.2236099243],[11.8623933792,37.1317062378],[42.4514732361,17.1490001678],[12.3994407654,33.29164505],[16.9511089325,23.9186573029],[35.6731948853,39.8441772461],[12.5465602875,35.1493034363],[9.0596399307,6.8744735718],[14.1446466446,43.2821922302],[20.3722991943,10.0606737137],[10.9833459854,21.1213626862],[21.8400096893,33.6858177185],[15.4624242783,20.5950374603],[27.8766803741,23.8532752991],[34.3081741333,23.8337402344],[20.2944259644,32.4344711304],[37.1119041443,36.0487060547],[32.6677207947,39.1898918152],[28.6532859802,41.1680145264],[37.6453704834,31.7002410889],[38.9111099243,23.5649471283],[32.0703163147,23.9259300232],[16.7866477966,22.1465530396],[41.6313819885,10.5061855316],[28.6370620728,41.1868438721],[17.6444835663,21.0975990295],[12.4187984467,29.2100219727],[13.1215610504,13.0110254288],[24.6937294006,47.6082305908],[8.7467479706,16.5561275482],[38.5024414062,34.7374649048],[31.3199119568,9.533657074],[32.181640625,22.6891155243],[8.4446659088,1.0048027039],[27.1937923431,5.9993534088],[27.4382228851,8.0109767914],[33.9556732178,6.2818107605],[27.9010028839,34.0225410461],[34.0339431763,6.5613594055],[29.8870410919,39.7945861816],[17.6448230743,21.0970897675],[27.9978981018,39.2298202515],[17.6444320679,21.0976543427],[13.5785684586,13.0681095123],[16.139919281,13.0984764099],[13.0234727859,35.5632629395],[33.8133583069,37.13879776],[27.4290370941,5.8298244476],[10.9280500412,6.9988765717],[34.8220825195,6.5576953888],[6.6068172455,43.6452102661],[5.9147586823,42.5359802246],[33.2105026245,7.2176265717],[11.9532546997,8.1402015686],[37.9057846069,13.6789426804],[41.5713615417,32.105796814],[33.8984947205,31.7368087769],[11.1512756348,33.5617980957],[24.7510375977,16.4751148224],[11.8256759644,7.2209091187],[8.7467479706,16.5561275482],[27.658115387,17.217830658],[27.4563751221,16.5391979218],[47.8228378296,29.0082378387],[47.8234024048,29.0082359314],[19.2812328339,8.1157512665],[13.8889904022,0.1752281189],[6.4164066315,43.5697174072],[41.5786399841,32.1074256897],[12.8087568283,7.1403369904],[25.293384552,47.0055923462],[13.9674882889,2.5321617126],[16.139919281,13.0984764099],[10.5328407288,3.9066047668],[13.5522575378,5.0832767487],[16.5982112885,28.1000518799],[11.9277715683,4.4846630096],[13.1227197647,5.6933498383],[38.7420730591,16.5141162872],[10.4786071777,6.042427063],[9.8428859711,9.4579467773],[36.5197143555,27.4515190125],[19.1815490723,21.2183876038],[12.3179559708,20.1842651367],[34.5010070801,6.0099697113],[29.958984375,28.2075691223],[29.9944400787,28.3247413635],[34.371219635,6.9015426636],[34.1427154541,6.0308589935],[33.9240951538,31.6435623169],[8.0651855469,15.6082954407],[15.6535272598,0.1581249237],[25.2362155914,13.4638547897],[12.9596643448,1.9061050415],[5.2804946899,4.3458118439],[5.2800426483,4.3463001251],[10.841006279,18.549659729],[16.139919281,13.0984764099],[17.6448001862,21.0970783234],[10.9223718643,26.3548164368],[25.2195262909,45.0247573853],[26.1311225891,47.0029220581],[11.7266893387,33.2893714905],[17.11302948,50.0998840332],[17.1128501892,50.0993041992],[14.1890420914,48.7688522339],[16.0803375244,50.1631660461],[12.7520704269,12.0818166733],[10.085351944,34.3843612671],[16.0833911896,50.1641693115],[13.5218000412,12.7426261902],[13.3752737045,13.200963974],[10.9223718643,26.3548164368],[17.5139694214,50.3792572021],[12.058344841,5.835817337],[11.6331338882,3.6570549011],[8.9999370575,39.144618988],[8.9991159439,39.1440620422],[6.4346504211,8.2830257416],[14.7485752106,6.4867420197],[9.2413959503,2.8287963867],[14.0126476288,3.6875629425],[10.2967596054,2.9324817657],[11.4849290848,34.7877159119],[11.1192417145,2.560251236],[12.0066337585,1.554605484],[10.9575023651,4.969587326],[9.4204206467,4.3042488098],[10.8811950684,34.5542869568],[11.8952169418,35.2384986877],[10.0183992386,35.1451301575],[10.6374006271,33.8372459412],[8.6079092026,3.6869373322],[13.434463501,4.2441043854],[11.6000347137,34.1980857849],[13.0585136414,33.5625],[12.9068250656,36.1800117493],[12.8648290634,6.3827667236],[11.9468736649,2.5038604736],[19.029876709,47.2648773193],[18.6922950745,47.61769104],[15.9891710281,48.9606056213],[16.3801994324,48.9051361084],[15.9891700745,48.9606056213],[16.1884174347,48.4016227722],[16.3801994324,48.9051361084],[9.4498558044,5.096036911],[13.1622142792,3.4669742584],[19.0211715698,47.2616958618],[18.6039543152,47.3398666382],[10.0687408447,2.0493621826],[8.488322258,4.7725505829],[13.7190723419,6.4312667847],[11.2370023727,6.2739849091],[11.35663414,35.4796295166],[20.2224845886,47.6849441528],[10.793469429,36.6520500183],[11.4092636108,36.5501823425],[12.8056364059,34.310962677],[12.2425003052,34.6198501587],[12.3578090668,44.3446617126],[20.0340461731,49.335357666],[19.7419052124,49.573223114],[20.2375831604,48.4102630615],[14.7538480759,39.9873809814],[12.3117952347,44.0485916138],[10.9223718643,26.3548164368],[12.2564239502,36.5010108948],[13.6223430634,36.2841491699],[9.1703128815,38.9334487915],[18.531003952,43.6511535645],[12.3117952347,44.0485916138],[15.1370630264,5.35846138],[18.6155452728,43.7384643555],[10.8302631378,35.8879547119],[10.051533699,6.6809978485],[13.8633613586,35.5266265869],[12.8656826019,44.2068023682],[18.0304069519,47.8156280518],[15.1480836868,0.0],[12.4037075043,3.9247398376],[11.2531261444,5.5327301025],[8.1136512756,39.3636550903],[8.52202034,5.8320121765],[11.0647411346,3.3573303223],[19.1970424652,49.0285110474],[19.347366333,49.3949966431],[19.4935112,44.2839889526],[13.6090478897,34.0810089111],[19.4935112,44.2839889526],[19.6528148651,48.571434021],[20.3486022949,49.1447753906],[14.7538480759,39.9873809814],[19.6474933624,45.1332931519],[12.8190069199,43.9551773071],[19.7198677063,48.4149551392],[20.4876689911,48.7102890015],[19.4935112,44.2839889526],[11.0079755783,1.6148948669],[14.755358696,3.2442340851],[14.7795124054,40.1486129761],[11.2198572159,4.3398780823],[11.8969182968,5.086812973],[12.8652982712,44.2257080078],[15.1005783081,4.269651413],[13.1215610504,13.0110225677],[9.7606649399,3.6070899963],[13.9720544815,7.3194103241],[10.2859611511,4.5749530792],[13.5141592026,12.7336702347]]}
            var clusters = {"columns":[0],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522],"data":[[10],[11],[10],[11],[11],[4],[4],[11],[0],[4],[13],[10],[11],[0],[10],[11],[10],[11],[11],[1],[5],[0],[4],[0],[11],[4],[4],[5],[4],[10],[10],[10],[10],[10],[10],[11],[11],[13],[13],[10],[13],[10],[4],[4],[10],[4],[13],[1],[1],[10],[10],[0],[0],[13],[4],[10],[13],[2],[0],[9],[0],[9],[0],[9],[13],[9],[13],[11],[4],[4],[0],[9],[11],[9],[9],[4],[11],[0],[0],[0],[0],[0],[11],[11],[11],[10],[13],[7],[11],[11],[10],[5],[5],[11],[4],[4],[4],[11],[0],[13],[9],[11],[11],[4],[2],[4],[0],[11],[0],[13],[10],[5],[4],[4],[5],[4],[5],[1],[1],[1],[5],[4],[5],[9],[10],[5],[4],[0],[11],[11],[4],[11],[1],[11],[11],[0],[9],[9],[11],[1],[11],[11],[0],[12],[13],[13],[5],[5],[5],[4],[5],[13],[10],[10],[0],[4],[0],[4],[1],[9],[13],[4],[11],[0],[13],[10],[4],[11],[13],[10],[10],[4],[0],[13],[5],[2],[2],[0],[0],[10],[11],[8],[5],[5],[0],[1],[11],[4],[14],[9],[11],[0],[9],[5],[11],[11],[13],[4],[11],[5],[0],[7],[4],[13],[6],[8],[14],[3],[11],[0],[13],[0],[11],[5],[0],[0],[0],[0],[0],[7],[0],[0],[11],[0],[7],[0],[11],[0],[5],[5],[13],[13],[1],[5],[1],[6],[4],[12],[8],[9],[4],[5],[4],[5],[5],[5],[8],[0],[8],[6],[5],[5],[4],[5],[5],[1],[1],[5],[14],[12],[5],[1],[8],[1],[1],[8],[8],[8],[0],[4],[12],[13],[8],[8],[13],[6],[6],[6],[6],[14],[14],[14],[8],[6],[6],[6],[10],[12],[12],[12],[4],[6],[6],[3],[14],[14],[6],[14],[6],[14],[7],[7],[14],[14],[12],[12],[12],[1],[11],[10],[12],[6],[3],[7],[12],[11],[12],[6],[5],[12],[14],[8],[2],[6],[1],[6],[13],[4],[1],[9],[5],[5],[9],[4],[4],[6],[11],[5],[6],[12],[2],[3],[6],[9],[7],[4],[14],[7],[7],[7],[13],[7],[5],[6],[5],[6],[2],[2],[12],[5],[7],[14],[7],[8],[8],[7],[14],[11],[9],[9],[12],[10],[14],[6],[10],[10],[0],[0],[2],[14],[8],[9],[14],[3],[14],[2],[14],[14],[1],[14],[14],[11],[14],[14],[4],[6],[6],[7],[13],[13],[7],[7],[9],[6],[14],[10],[14],[14],[14],[6],[2],[6],[6],[3],[3],[12],[3],[3],[3],[3],[2],[12],[3],[2],[2],[6],[3],[14],[14],[8],[8],[14],[14],[14],[14],[14],[12],[14],[14],[14],[14],[12],[12],[12],[12],[14],[14],[12],[12],[12],[14],[14],[3],[3],[3],[3],[3],[3],[3],[14],[14],[3],[3],[14],[14],[14],[14],[12],[3],[12],[12],[12],[12],[8],[3],[3],[3],[12],[8],[6],[12],[12],[8],[3],[8],[14],[3],[12],[14],[12],[8],[3],[14],[14],[14],[8],[14],[14],[3],[3],[3],[12],[3],[3],[3],[12],[3],[8],[3],[3],[3],[14],[14],[12],[14],[14],[8],[14],[2],[14],[14],[14],[2]]}
            let box = document.querySelector('.box');
            const width = box.offsetWidth;
            const height = 500;

            var svg = d3.select('svg');  
            var dimension = document.body
                .getBoundingClientRect();
            
            var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "1px")
            .style("border-radius", "5px")
            .style("padding", "10px")
            .style("z-index", "10")
            .style("visibility", "hidden")
            ;
            var data = d3.range(0, embeddings['data'].length).map(function (d) {
                return {
                x: embeddings['data'][d][1],
                y: embeddings['data'][d][0]
              }
            });

            var x = d3.scaleLinear()
            .domain([-3, 55])
            .range([ 0, width ]);

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, 55])
                .range([ height, 0]);

            
            var zoom = d3.zoom()
                .scaleExtent([.5, 10])  // This control how much you can unzoom (x0.5) and zoom (x20)
                .extent([[0, 0], [width, height]])
                .on("zoom", updateChart);
          
            var svg = d3.select("svg")
                .attr('width', width)
                .attr('height', height)
                .style('background', 'white')
                .attr("style", "outline: thin solid gray;")
                .call(zoom)                       // Adds zoom functionality

            var canvas = svg
                .append("g")
                .attr("class", "zoomable")
            
              function updateChart() {
                if (canvas) {
                    canvas.attr("transform", d3.event.transform);
                    // recover the new scale
                    var newX = d3.event.transform.rescaleX(x);
                    var newY = d3.event.transform.rescaleY(y);
                
                
                    // update circle position
                    canvas.selectAll("circle")
                        .attr('cx', function(d) {return newX(d.x)})
                        .attr('cy', function(d) {return newY(d.y)});
                }
              }

            canvas.selectAll('circle')
                .data(data)
                .enter()
                .append('circle')
                .attr("r", function(_, i, n){
                    let vol_index = headersWhiteList.indexOf('Volume')
                    try{
                        let volume = parseInt(dataset[i][vol_index].replaceAll(",",""))
                        if (isNaN(volume)){
                            return 10
                        }
                        else
                            return Math.log(volume)
                    }catch(err){
                        return 10
                    }
                    
                }) 
                .attr('opacity', 0.8)
                .attr('cx', function(d) {
                    return x(d.x);})
                .attr('cy', function(d) {
                    return y(d.y)})
                .style('fill', function(_, i, n) {
                    const index = clusters['data'][i][0]
                    return d3.schemeCategory20[index]
                }).on("mouseover", function(_, i, n){                    
                    tooltip = tooltip.html(createHtml(i));
                    d3.select(this).style('stroke', '#eaeaea')
                    d3.select(this).style('stroke-width', '5')
                    return tooltip.style("visibility", "visible");
                })
                .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
                .on("mouseout", function(){
                    d3.select(this).style('stroke', 'white')
                    d3.select(this).style('stroke-width', '0')
                    return tooltip.style("visibility", "hidden");
                })
                .on("click", function(_, i, n){
                    let url = 'card.html?'+i;
                    window.open(url, '_blank').focus();
                });


    })
    .catch(function(error) {
        console.log(error);
    });

            
